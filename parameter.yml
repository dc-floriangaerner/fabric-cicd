# Parameter Configuration for Fabric CI/CD
# This file defines find/replace patterns for transforming workspace item IDs
# across different environments (dev, test, prod)

find_replace:
    # Replace Bronze Lakehouse in Notebooks
    # Find the Dev lakehouse ID and replace with the target environment's ID
    - find_value: "" # TODO: Add Item Id of lakehouse_bronze in Dev workspace
      replace_value:
        _ALL_: "$items.Lakehouse.lakehouse_bronze.id"
      item_type: "Notebook"
      description: "Replace Bronze Lakehouse ID in all notebooks"
    
    # Replace Silver Lakehouse in Notebooks
    - find_value: "" # TODO: Add Item Id of lakehouse_silver in Dev workspace
      replace_value:
        _ALL_: "$items.Lakehouse.lakehouse_silver.id"
      item_type: "Notebook"
      description: "Replace Silver Lakehouse ID in all notebooks"

    # Replace Gold Lakehouse in Notebooks
    - find_value: "" # TODO: Add Item Id of lakehouse_gold in Dev workspace
      replace_value:
        _ALL_: "$items.Lakehouse.lakehouse_gold.id"
      item_type: "Notebook"
      description: "Replace Gold Lakehouse ID in all notebooks"

    # Replace Dev Workspace Id in Notebooks
    - find_value: "" # TODO: Add Workspace Id of Dev Workspace
      replace_value:
        _ALL_: "$workspace.id"
      item_type: "Notebook"
      description: "Replace workspace ID references in notebooks"
      
    # Replace Connection String in Semantic Model (SQL endpoint)
    - find_value: 'database\s*=\s*Sql\.Database\s*\(\s*"([^"]+)"'
      replace_value:
          _ALL_: "$items.Lakehouse.lakehouse_silver.sqlendpoint"
      is_regex: "true"
      item_type: "SemanticModel"
      description: "Replace SQL endpoint in semantic models"
      
    # Replace Database ID in Semantic Model with Database Name
    - find_value: 'database\s*=\s*Sql\.Database\s*\(\s*"[^"]+"\s*,\s*"([^"]+)"'
      replace_value:
          _ALL_: "lakehouse_silver"
      is_regex: "true"
      item_type: "SemanticModel"
      description: "Replace database name in semantic models"

# Additional configuration options (optional)
deployment_options:
    # Item types in scope for deployment
    # Uncomment and modify if you want to limit deployment to specific item types
    # item_types_in_scope:
    #   - "Lakehouse"
    #   - "Notebook"
    #   - "SemanticModel"
    #   - "DataPipeline"
    #   - "Environment"
    
    # Skip orphan cleanup (set to true to keep items not in repository)
    skip_orphan_cleanup: false
    
    # Deployment timeout in seconds
    timeout: 3600
